<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width,user-scalable=no, initial-scale=1">
<link href="{:ADDON_PUBLIC_PATH}/css/scratch.css" rel="stylesheet" type="text/css">

<body id="scratch">

<div class="bg_gray"></div>
<!--以下是支付提示层-->
<div class="touch_us">
    <div class="touch_us_01">
        <div class="tu_font">
        </div>
    </div>
</div>
<!--以上是支付提示层-->


<div class="container body">
    <div class="scr_top">
        <img src="{:ADDON_PUBLIC_PATH}/img/top.jpg"/>
        <!--<div class="area">-->
        <div class="ggk_01">

            <img src="{:ADDON_PUBLIC_PATH}/img/area_01.jpg"/>
            <canvas class="ggk_div"></canvas>
            <img style="margin-top: -80px;" src="{:ADDON_PUBLIC_PATH}/img/area_02.jpg"/>

        </div>
    </div>

</div>
<div class="block_out">
    <div class="block_inner">
        <h6>活动详情</h6>
        
        <p style="font-size:12px;"><b style="font-size:14px;line-height:16px;">一等奖</b>：免费体验果果哒水果套餐<i>1</i>月<br/>
           <b style="font-size:14px;line-height:16px;">二等奖</b>：免费体验果果哒水果套餐<i>1</i>周<br/>
           <b style="font-size:14px;line-height:16px;">三等奖</b>：免费体验果果哒水果套餐<i>2</i>天</p>
        <p><b>活动说明</b></p>   
        <p style="line-height:10px;margin-top:-6px;">1. 此次活动仅限高新区内用户,每个微信号每天有一次刮奖机会;</p>
        <p style="line-height:10px;margin-top:-6px;">2. 领奖时，请正确填写您的配送地址，配送地址仅限高新区;</p>
        <p style="line-height:10px;margin-top:-6px;">3. 活动时间：2014-11-10至2014-11-13,如有疑问，请致电028-83389832。</p>
    </div>
</div>
<!--中将记录 -->
<div class="block_out">

    <div class="block_inner">
        <h6>我的中奖记录</h6>
        <div class="ggk_table_father">
            <table class="ggk_table" cellpadding="0" cellspacing="0">
               
                <volist name="prizes" id="vo"> 
                	<if condition="$vo.prize eq 3" > 
                		<tr>
		                    <td class="ggk_td_01"><span>果果哒水果体验一月</span></td>
		                    <if condition="$vo.isGet eq 1 "><td class="ggk_td_02">已领奖</td>
    						<else /> 
    								<td class="ggk_td_02">
    								<a href="http://www.kmark.cn/gogoda/index.php?s=addon/Guaguaka/Guaguaka/logistic/prizeid/{$vo.id}/">去领奖</a>
    								</td>
 							</if>
		                    
                		</tr>
					 <elseif condition="$vo.prize eq 4"/>
					 	<tr>
		                    <td class="ggk_td_01"><span>果果哒水果体验一周</span></td>
		                    <if condition="$vo.isGet eq 1 "><td class="ggk_td_02">已领奖</td>
    						<else /> 
    								<td class="ggk_td_02">
    								<a href="http://www.kmark.cn/gogoda/index.php?s=addon/Guaguaka/Guaguaka/logistic/prizeid/{$vo.id}/">去领奖</a>
    								</td>
 							</if>
                		</tr>
					 <else /> 
					 	<tr>
		                    <td class="ggk_td_01"><span>果果哒水果体验二天</span></td>
		                    <if condition="$vo.isGet eq 1 "><td class="ggk_td_02">已领奖</td>
    						<else /> 
    								<td class="ggk_td_02">
    								<a href="http://www.kmark.cn/gogoda/index.php?s=addon/Guaguaka/Guaguaka/logistic/prizeid/{$vo.id}/">去领奖</a>
    								</td>
 							</if>
                		</tr>
					 </if>
                </volist> 
                
            </table>
        </div>
       
    </div>
</div>
<input type="hidden" value="{$myPrize}" id="myPrize">

<script type="text/javascript" src="{:ADDON_PUBLIC_PATH}/js/jquery.min.js"></script>
<script>
var body_hgt = $('body').height(),
	body_wid = $('body').width();

function check1(){
    $('.tu_font').text('亲,您还没关注我们,暂时不能参加此活动哟,先去關注我們果果嗒吧');
    //alert(1)
    ab();setTimeout(abcd,5000);

}
function  check2(){
    $('.tu_font').text('亲,你今天已经刮奖了,明天再来哟...');
    //alert(1)
    ab();setTimeout(abcd,2000);
}

function  prize2(){
    $('.tu_font').html("恭喜你!<br/>&nbsp;&nbsp;&nbsp;&nbsp;亲,运气真好,你中了<span style='color:red'>二等奖</span>,免费体验果果哒水果一周哟！&nbsp;&nbsp;<br/><a href='http://www.kmark.cn/gogoda/index.php?s=addon/Guaguaka/Guaguaka/logistic/prizeid/{$prizeid}/'>前去领奖</a></br><a href='https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx84ecbf099434ca1d&redirect_uri=http%3A%2F%2Fwww.kmark.cn%2Foauth0.php&response_type=code&scope=snsapi_base&state=6#wechat_redirect' ><button  class='ggk_btn_close ggk_btn'>暂不领奖</button></a>");
    //alert(1)
    ab();//setTimeout(abcd,3000);
}
function  prize1(){
    $('.tu_font').html("恭喜你!<br/>&nbsp;&nbsp;&nbsp;&nbsp;亲,运气真好,你中了<span style='color:red'>一等奖</span>,免费体验果果哒水果一个月哟!&nbsp;&nbsp;<br/><a href='http://www.kmark.cn/gogoda/index.php?s=addon/Guaguaka/Guaguaka/logistic/prizeid/{$prizeid}/'>前去领奖</a></br><a href='https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx84ecbf099434ca1d&redirect_uri=http%3A%2F%2Fwww.kmark.cn%2Foauth0.php&response_type=code&scope=snsapi_base&state=6#wechat_redirect' ><button  class='ggk_btn_close ggk_btn'>暂不领奖</button></a>");
    //alert(1)
    ab();//setTimeout(abcd,3000);
}
function  prize3(){
    $('.tu_font').html("恭喜你!<br/>&nbsp;&nbsp;&nbsp;&nbsp;亲,运气真好,你中了<span style='color:red'>三等奖</span>,免费体验果果哒水果二天哟!&nbsp;&nbsp;<br/><a href='http://www.kmark.cn/gogoda/index.php?s=addon/Guaguaka/Guaguaka/logistic/prizeid/{$prizeid}/'>前去领奖</a></br><a href='https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx84ecbf099434ca1d&redirect_uri=http%3A%2F%2Fwww.kmark.cn%2Foauth0.php&response_type=code&scope=snsapi_base&state=6#wechat_redirect' ><button  class='ggk_btn_close ggk_btn'>暂不领奖</button></a>");
    //alert(1)
    ab();//setTimeout(abcd,3000);
}
function  prize0(){
    $('.tu_font').html("亲,还差一点,再接再厉,明天再来吧!<br/>");
    //alert(1)
    ab();
    setTimeout(abcd,2000);
}
function abcd(){
    $('.touch_us').hide();
    $('.append_div').hide();
    $('.bg_gray').hide();
}
function ab(){
    $('.touch_us').show();
    $('.append_div').show();
    ggk_bg();
}
function ggk_close(){
	abcd();
}
function ggk_bg(){
	$('.bg_gray').width(body_wid).height(body_hgt).show();
}
function getPri(){
	//alert(1)
	var myPrize = document.getElementById('myPrize').value;
	 //动态添加ajax
    $.ajax({
    	type: "GET",
        	url: "http://www.kmark.cn/gogoda/index.php?s=addon/Guaguaka/Guaguaka/changeKill/",
        	dataType: "json",
        	success: function(data){
        		if(parseInt(data)==1){
            		if(myPrize==3){
                    prize1();
                }else if(myPrize==4){
                    prize2();
                }else if(myPrize==5){
                    prize3();
                }else if(myPrize==2){
                    prize0();
                }
        		}
        	}
       	 
    })
}

$(function(){

	$('.ggk_btn_more').click(function(){
		$('.ggk_table_father').css({
			'height':'auto',
			'overflow':'auto'
		})
	})

});
</script>

<script>
//JS刮刮卡
(function(bodyStyle){
           var myPrize = document.getElementById('myPrize').value;

            bodyStyle.mozUserSelect = 'none';
            bodyStyle.webkitUserSelect = 'none';

            var img = new Image();
            var canvas = document.querySelector ('canvas');
            canvas.style.backgroundColor = 'transparent';
            //canvas.style.position = 'relative';

            img.addEventListener('load', function (e) {
                var ctx;

                /*var w = img.width,
                 h = img.height;*/
                var w = 200,
                    h = 80;

                var offsetX = canvas.offsetLeft,
                    offsetY = canvas.offsetTop;
                var mousedown = false;

                function layer(ctx){
                    ctx.fillStyle = 'gray';
                    ctx.fillRect (0, 0, w, h);
                }

                function eventDown(e){
                	setTimeout(getPri,3000);
                	e.preventDefault ();
                    mousedown = true;
                    

                }

                function eventUp (e) {
                    e.preventDefault ();
                    mousedown = false;
                    
                }

                function eventMove (e) {
                    if(myPrize==0){
                        check1();
                        mousedown = false;
                    }
                    if(myPrize==1){
                        check2();
                        mousedown = false;
                    }
                    e.preventDefault ();
                    if (mousedown) {
                        if (e.changedTouches) {
                            e = e.changedTouches[e.changedTouches.length - 1];
                        }
                        var x = (e.clientX + document.body.scrollLeft || e.pageX) - offsetX || 0,
                                y = (e.clientY + document.body.scrollTop || e.pageY) - offsetY || 0;
                        with (ctx) {
                            beginPath ();
                            //这里限制挂的大小
                            arc (x, y, 7, 0, Math.PI * 2);
                            fill ();
                        }
                    }
                }

                canvas.width = w;
                canvas.height = h;
                canvas.style.backgroundImage='url(' + img.src + ')';
                ctx = canvas.getContext ('2d');
                ctx.fillStyle = 'transparent';
                ctx.fillRect (0, 0, w, h);
                layer (ctx);

                ctx.globalCompositeOperation = 'destination-out';

                canvas.addEventListener ('touchstart', eventDown);
                canvas.addEventListener ('touchend', eventUp);
                canvas.addEventListener ('touchmove', eventMove);
                canvas.addEventListener ('mousedown', eventDown);
                canvas.addEventListener ('mouseup', eventUp);
                canvas.addEventListener ('mousemove', eventMove);
            });
            //img.src = 'prize.jpg';
            if(myPrize==2 || myPrize==0 || myPrize==1){
                img.src = '{:ADDON_PUBLIC_PATH}/img/4.jpg';
            }
            if(myPrize==3){
                img.src = '{:ADDON_PUBLIC_PATH}/img/1.jpg';
            }
            if(myPrize==4){
                img.src = '{:ADDON_PUBLIC_PATH}/img/2.jpg';
            }
            if(myPrize==5){
                img.src = '{:ADDON_PUBLIC_PATH}/img/3.jpg';
            }

        })(document);






</script>
</body>
</html>
